
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../splunk/splunk.html">
      
      
        <link rel="next" href="../understanding-IDS-IPS/understanding-IDS-IPS.html">
      
      
      <link rel="icon" href="../images/Cyber Defence Kit logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Wazuh - Cyber Defence Kit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Wazuh - Cyber Defence Kit" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="./assets/images/social/wazuh/wazuh.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="None" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Wazuh - Cyber Defence Kit" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="./assets/images/social/wazuh/wazuh.png" >
      
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wazuh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Cyber Defence Kit" class="md-header__button md-logo" aria-label="Cyber Defence Kit" data-md-component="logo">
      
  <img src="../images/Cyber Defence Kit logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cyber Defence Kit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Wazuh
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../CDK-explained/CDK-explained.html" class="md-tabs__link">
          
  
  
    
  
  About CDK

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../understanding-SIEM/understanding-SIEM.html" class="md-tabs__link">
          
  
  
    
  
  SIEM

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../understanding-IDS-IPS/understanding-IDS-IPS.html" class="md-tabs__link">
          
  
  
    
  
  IDS/IPS

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../understanding-SIRP/understanding-SIRP.html" class="md-tabs__link">
          
  
  
    
  
  SIRP

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../understanding-SOAR/understanding-SOAR.html" class="md-tabs__link">
          
  
  
    
  
  SOAR

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../understanding-NTA/understanding-NTA.html" class="md-tabs__link">
          
  
  
    
  
  NTA

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../understanding-DFIR/understanding-DFIR.html" class="md-tabs__link">
          
  
  
    
  
  DFIR

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../understanding-EDR/understanding-EDR.html" class="md-tabs__link">
          
  
  
    
  
  EDR

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../caldera/caldera.html" class="md-tabs__link">
          
  
  
    
  
  MITRE

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../splunk-cheat-sheet/splunk-cheat-sheet.html" class="md-tabs__link">
          
  
  
    
  
  Cheat Sheets

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Cyber Defence Kit" class="md-nav__button md-logo" aria-label="Cyber Defence Kit" data-md-component="logo">
      
  <img src="../images/Cyber Defence Kit logo.png" alt="logo">

    </a>
    Cyber Defence Kit
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About CDK
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            About CDK
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CDK-explained/CDK-explained.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cyber Defence Kit Explained
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    SIEM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            SIEM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-SIEM/understanding-SIEM.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding SIEM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../splunk/splunk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Splunk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Wazuh
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="wazuh.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Wazuh
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-setup-for-proof-of-concept" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Setup for Proof of Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-wazuh-server-offline" class="md-nav__link">
    <span class="md-ellipsis">
      Install Wazuh Server offline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install Wazuh Server offline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-firewall-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Firewall (Optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloading-the-packages-and-configuration-files" class="md-nav__link">
    <span class="md-ellipsis">
      Downloading the Packages and Configuration Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-wazuh-components" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Wazuh Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-wazuh-indexer" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Wazuh Indexer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-wazuh-server" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Wazuh server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-filebeat" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Filebeat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-wazuh-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Wazuh Dashboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-certificate-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Importing Certificate (Optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#securing-wazuh-installation-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Securing Wazuh Installation (Optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-wazuh-agents-on-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Wazuh Agents on Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing Wazuh Agents on Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-firewall-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Firewall on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-wazuh-agent-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Wazuh agent on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-windows-wazuh-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting Windows Wazuh Agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysmon-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Sysmon Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-network-devices-with-wazuh" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring Network Devices with Wazuh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring Network Devices with Wazuh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-syslog-logging-on-fortigate" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Syslog Logging on FortiGate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-log-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Log Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-syslog-on-wazuh-server-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Syslog on Wazuh Server (Optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-rsyslog-on-ubuntu-endpoint-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Rsyslog on Ubuntu endpoint (Recommended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-wazuh-agent-on-linux-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Wazuh agent on Linux (Ubuntu)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-wazuh-to-monitor-fortigate-log" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Wazuh to Monitor Fortigate Log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-decoders-and-rules-for-fortigate" class="md-nav__link">
    <span class="md-ellipsis">
      Default Decoders and Rules for FortiGate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Event Logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Event Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-compression-and-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Log Compression and Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archiving-event-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Archiving Event Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-archiving" class="md-nav__link">
    <span class="md-ellipsis">
      Enabling archiving
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-events-on-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising Events on Dashboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-wazuh-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Wazuh Dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-wazuh" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Wazuh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Wazuh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-case-detecting-signed-binary-proxy-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Use case: Detecting Signed Binary Proxy Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#atomic-red-team-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Atomic Red Team Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attack-emulation" class="md-nav__link">
    <span class="md-ellipsis">
      Attack Emulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wazuh-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Wazuh Dashboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-index-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting Index Patterns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detecting-suspicious-binaries-testing-endpoint-security" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Suspicious Binaries (Testing Endpoint Security)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detecting Suspicious Binaries (Testing Endpoint Security)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attack-emulation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Attack Emulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-alerts" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising Alerts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-integrity-monitoring-testing-endpoint-security" class="md-nav__link">
    <span class="md-ellipsis">
      File Integrity Monitoring (Testing Endpoint Security)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Integrity Monitoring (Testing Endpoint Security)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-ubuntu-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Ubuntu Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-alerts_1" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising Alerts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vulnerability-detection-testing-threat-intelligence" class="md-nav__link">
    <span class="md-ellipsis">
      Vulnerability Detection (Testing Threat Intelligence)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Detection (Testing Threat Intelligence)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-alerts_2" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising Alerts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wazuh-active-response-module" class="md-nav__link">
    <span class="md-ellipsis">
      Wazuh Active Response module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-active-response-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Default Active Response Actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-active-response-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Active Response Actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disabling-user-account-after-a-brute-force-attack-testing-default-active-response" class="md-nav__link">
    <span class="md-ellipsis">
      Disabling User Account After a Brute-Force Attack (Testing Default Active Response)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blocking-a-known-malicious-actor-testing-custom-active-response" class="md-nav__link">
    <span class="md-ellipsis">
      Blocking a Known Malicious Actor (Testing Custom Active Response)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Blocking a Known Malicious Actor (Testing Custom Active Response)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-ubuntu-endpoint_1" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Ubuntu endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-wazuh-server" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the Wazuh server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-the-active-response-module-to-block-the-malicious-ip-address" class="md-nav__link">
    <span class="md-ellipsis">
      Configure the active response module to block the malicious IP address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attack-emulation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Attack Emulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-alerts_3" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising Alerts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-ids-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Network IDS integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network IDS integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#snort3" class="md-nav__link">
    <span class="md-ellipsis">
      Snort3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suricata" class="md-nav__link">
    <span class="md-ellipsis">
      Suricata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attack-emulation_3" class="md-nav__link">
    <span class="md-ellipsis">
      Attack Emulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    IDS/IPS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            IDS/IPS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-IDS-IPS/understanding-IDS-IPS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding IDS/IPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snort/snort.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Snort
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../suricata/suricata.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Suricata
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SIRP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            SIRP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-SIRP/understanding-SIRP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding SIRP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thehive/thehive.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TheHive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iris/iris.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IRIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SOAR
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            SOAR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-SOAR/understanding-SOAR.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding SOAR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shuffle/shuffle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shuffle
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    NTA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            NTA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-NTA/understanding-NTA.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding NTA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wireshark/wireshark.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Wireshark
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zeek/zeek.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zeek
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zui/zui.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zui
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DFIR
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            DFIR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-DFIR/understanding-DFIR.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding DFIR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../velociraptor/velociraptor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Velociraptor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    EDR
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            EDR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-EDR/understanding-EDR.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding EDR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auroralite/auroralite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aurora Lite
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MITRE
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            MITRE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../caldera/caldera.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caldera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../navigator/navigator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MITRE ATT&CK Navigator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cheat Sheets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Cheat Sheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../splunk-cheat-sheet/splunk-cheat-sheet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Splunk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../velociraptor-cheat-sheet/velociraptor-cheat-sheet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Velociraptor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="wazuh"><strong>Wazuh</strong></h1>
<p>Wazuh is the open source security platform that unifies XDR and SIEM protection for endpoints and cloud workloads. It is designed to help organisations detect threats, monitor integrity, and ensure compliance across their infrastructure, including physical, virtual, containerised, and cloud environments.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yuwhqNPKO0M?si=2PDVAquSS2iC6Ico" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2 id="lab-setup-for-proof-of-concept"><strong>Lab Setup for Proof of Concept</strong></h2>
<p>In this proof of concept, attack emulation was conducted on the FortiGate VM, Windows and Ubuntu hosts in a safe and controlled setting. </p>
<p><strong>Note: Do not attempt to replicate the attack emulation demonstrated here unless you are properly trained and it is safe to do so. Unauthorised attack emulation can lead to legal consequences and unintended damage to systems. Always ensure that such activities are conducted by qualified professionals in a secure, isolated environment.</strong></p>
<table>
<thead>
<tr>
<th><strong>Host</strong></th>
<th><strong>OS</strong></th>
<th><strong>Role</strong></th>
<th><strong>IP Address</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Fortigate</td>
<td>Fortios 7.6.0</td>
<td>Firewall/Router</td>
<td>192.168.1.111 (WAN) / 10.0.0.1 (LAN)</td>
</tr>
<tr>
<td>WazuhServer</td>
<td>Centos Stream 9</td>
<td>Wazuh server</td>
<td>10.0.0.20</td>
</tr>
<tr>
<td>WS2019</td>
<td>Windows Server 2019</td>
<td>Wazuh agent</td>
<td>10.0.0.24</td>
</tr>
<tr>
<td>SyslogUbuntu</td>
<td>Ubuntu 22.04 LTS</td>
<td>Wazuh agent, rsyslog server</td>
<td>10.0.0.26</td>
</tr>
<tr>
<td>Kali</td>
<td>Kali Linux 2024.2</td>
<td>Attacker machine</td>
<td>192.168.1.161, 10.0.0.29</td>
</tr>
</tbody>
</table>
<p><a class="glightbox" href="Wazuh_PoC.drawio.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Wazuh PoC.drawio.png" src="Wazuh_PoC.drawio.png" /></a></p>
<h2 id="install-wazuh-server-offline"><strong>Install Wazuh Server offline</strong></h2>
<p>To install Wazuh offline, first download its core components for later installation on a system without Internet access. You can set up the Wazuh server, indexer, and dashboard on a single host (all-in-one deployment) or install them separately across multiple hosts (distributed deployment), depending on your requirements. See the <a href="https://documentation.wazuh.com/current/installation-guide/wazuh-server/index.html">Wazuh Server requirements</a> for details.</p>
<p><strong>Note:</strong> Root user privileges are required to run the following commands.</p>
<h3 id="prerequisites"><strong>Prerequisites</strong></h3>
<p>Ensure that <code>curl</code>, <code>tar</code>, and <code>setcap</code> are installed on the target system for the offline installation. On some Debian-based systems, <code>gnupg</code> may also be required.</p>
<p>Additionally, some systems have <code>cp</code> set as an alias for <code>cp -i</code>, which prompts for confirmation before overwriting files. To prevent this, run <code>unalias cp</code>.</p>
<h3 id="configuring-firewall-optional"><strong>Configuring Firewall (Optional)</strong></h3>
<p>Configure Firewall rule to allow access on required ports</p>
<p><strong>CentOS:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-port<span class="o">=</span><span class="m">9200</span>/tcp<span class="w"> </span>--permanent<span class="w"> </span><span class="c1">#Wazuh-indexer</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-port<span class="o">=</span><span class="m">55000</span>/tcp<span class="w"> </span>--permanent<span class="w"> </span><span class="c1">#enrollment service</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-port<span class="o">=</span><span class="m">1514</span>/tcp<span class="w"> </span>--permanent<span class="w"> </span><span class="c1">#agent communication</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-port<span class="o">=</span><span class="m">1515</span>/tcp<span class="w"> </span>--permanent<span class="w"> </span><span class="c1">#enrollment service</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="c1">#Apply changes</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>firewall-cmd<span class="w"> </span>--reload
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1">#Check applied</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>firewall-cmd<span class="w"> </span>--list-all
</code></pre></div>
<p><strong>Ubuntu:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">9200</span>/tcp
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">55000</span>/tcp
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">1514</span>/tcp
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">1515</span>/tcp
</code></pre></div>
<h3 id="downloading-the-packages-and-configuration-files"><strong>Downloading the Packages and Configuration Files</strong></h3>
<p>From any Linux system with Internet access, run the following commands to execute a script that downloads all necessary files for offline installation on x86_64 architectures. Choose the appropriate package format to download.</p>
<p><strong>RPM:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>curl<span class="w"> </span>-sO<span class="w"> </span>https://packages.wazuh.com/4.11/wazuh-install.sh
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>chmod<span class="w"> </span><span class="m">744</span><span class="w"> </span>wazuh-install.sh
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>./wazuh-install.sh<span class="w"> </span>-dw<span class="w"> </span>rpm
</code></pre></div>
<p><strong>DEB:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>curl<span class="w"> </span>-sO<span class="w"> </span>https://packages.wazuh.com/4.11/wazuh-install.sh
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>chmod<span class="w"> </span><span class="m">744</span><span class="w"> </span>wazuh-install.sh
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>./wazuh-install.sh<span class="w"> </span>-dw<span class="w"> </span>deb
</code></pre></div>
<p>Download the certificates configuration file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>curl<span class="w"> </span>-sO<span class="w"> </span>https://packages.wazuh.com/4.11/config.yml
</code></pre></div>
<p>Modify <code>config.yml</code> to set up certificate creation.</p>
<ul>
<li>For an <strong>all-in-one deployment</strong>, replace <code>"&lt;indexer-node-ip&gt;"</code>, <code>"&lt;wazuh-manager-ip&gt;"</code>, and <code>"&lt;dashboard-node-ip&gt;"</code> with <code>127.0.0.1</code>.</li>
<li>For a <strong>distributed deployment</strong>, update the node names and IP addresses with the correct values for the Wazuh server, indexer, and dashboard. Add extra node fields as required.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>nodes:
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="c1"># Wazuh indexer nodes</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span>indexer:
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span>-<span class="w"> </span>name:<span class="w"> </span>node-1
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">      </span>ip:<span class="w"> </span><span class="m">10</span>.0.0.20
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="c1">#- name: node-2</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="c1">#  ip: &quot;&lt;indexer-node-ip&gt;&quot;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="c1">#- name: node-3</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="c1">#  ip: &quot;&lt;indexer-node-ip&gt;&quot;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">  </span><span class="c1"># Wazuh server nodes</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="c1"># If there is more than one Wazuh server</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">  </span><span class="c1"># node, each one must have a node_type</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">  </span>server:
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span>-<span class="w"> </span>name:<span class="w"> </span>wazuh-1
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">      </span>ip:<span class="w"> </span><span class="m">10</span>.0.0.20
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="c1">#  node_type: master</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="c1">#- name: wazuh-2</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="c1">#  ip: &quot;&lt;wazuh-manager-ip&gt;&quot;</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="c1">#  node_type: worker</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="c1">#- name: wazuh-3</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="c1">#  ip: &quot;&lt;wazuh-manager-ip&gt;&quot;</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">    </span><span class="c1">#  node_type: worker</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">  </span><span class="c1"># Wazuh dashboard nodes</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">  </span>dashboard:
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">    </span>-<span class="w"> </span>name:<span class="w"> </span>dashboard
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">      </span>ip:<span class="w"> </span><span class="m">10</span>.0.0.20
</code></pre></div>
<p>Run the <code>./wazuh-install.sh -g</code> to generate the certificates. For a multi-node cluster, these certificates need to be later deployed to all Wazuh instances in your cluster.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>./wazuh-install.sh<span class="w"> </span>-g
</code></pre></div>
<p>Transfer the following files to a directory on the host(s) where the offline installation will be performed. You can use <code>scp</code> for this:</p>
<ul>
<li><code>wazuh-install.sh</code></li>
<li><code>wazuh-offline.tar.gz</code></li>
<li><code>wazuh-install-files.tar</code></li>
</ul>
<h3 id="installing-wazuh-components"><strong>Installing Wazuh Components</strong></h3>
<p>In the working directory where you placed <code>wazuh-offline.tar.gz</code> and <code>wazuh-install-files.tar</code>, execute the following command to decompress the installation files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">tar</span> <span class="n">xf</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">offline</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">tar</span> <span class="n">xf</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">files</span><span class="o">.</span><span class="n">tar</span>
</code></pre></div>
<h3 id="installing-the-wazuh-indexer"><strong>Installing the Wazuh Indexer</strong></h3>
<p><strong>RPM:</strong></p>
<p>The following dependencies must be installed on the Wazuh indexer nodes.</p>
<ul>
<li>coreutils</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>rpm<span class="w"> </span>--import<span class="w"> </span>./wazuh-offline/wazuh-files/GPG-KEY-WAZUH
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>rpm<span class="w"> </span>-ivh<span class="w"> </span>./wazuh-offline/wazuh-packages/wazuh-indexer*.rpm
</code></pre></div>
<p><strong>DEB:</strong></p>
<p>The following dependencies must be installed on the Wazuh indexer nodes.</p>
<ul>
<li>debconf</li>
<li>adduser</li>
<li>procps</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nx">dpkg</span><span class="w"> </span><span class="o">-</span><span class="nx">i</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="nx">wazuh</span><span class="o">-</span><span class="nx">offline</span><span class="o">/</span><span class="nx">wazuh</span><span class="o">-</span><span class="nx">packages</span><span class="o">/</span><span class="nx">wazuh</span><span class="o">-</span><span class="nx">indexer</span><span class="o">*</span><span class="p">.</span><span class="nx">deb</span>
</code></pre></div>
<p>Run the following commands replacing <code>&lt;indexer-node-name&gt;</code> with the name of the Wazuh indexer node you are configuring as defined in <code>config.yml</code>. For example, <code>node-1</code>. This deploys the SSL certificates to encrypt communications between the Wazuh central components.</p>
<p>On CentOS, if you encounter the error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>chmod:<span class="w"> </span>cannot<span class="w"> </span>access<span class="w"> </span><span class="s1">&#39;/etc/wazuh-indexer/certs/*&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directorty
</code></pre></div>
<p>Navigate to <code>/etc/wazuh-indexer/certs/</code> and run <code>chmod 400 *</code> as the root user.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nv">NODE_NAME</span><span class="o">=</span>&lt;INDEXER_NODE_NAME&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>mkdir<span class="w"> </span>/etc/wazuh-indexer/certs
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>mv<span class="w"> </span>-n<span class="w"> </span>wazuh-install-files/<span class="nv">$NODE_NAME</span>.pem<span class="w"> </span>/etc/wazuh-indexer/certs/indexer.pem
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>mv<span class="w"> </span>-n<span class="w"> </span>wazuh-install-files/<span class="nv">$NODE_NAME</span>-key.pem<span class="w"> </span>/etc/wazuh-indexer/certs/indexer-key.pem
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>mv<span class="w"> </span>wazuh-install-files/admin-key.pem<span class="w"> </span>/etc/wazuh-indexer/certs/
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>mv<span class="w"> </span>wazuh-install-files/admin.pem<span class="w"> </span>/etc/wazuh-indexer/certs/
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>cp<span class="w"> </span>wazuh-install-files/root-ca.pem<span class="w"> </span>/etc/wazuh-indexer/certs/
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>chmod<span class="w"> </span><span class="m">500</span><span class="w"> </span>/etc/wazuh-indexer/certs
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/etc/wazuh-indexer/certs/*
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>chown<span class="w"> </span>-R<span class="w"> </span>wazuh-indexer:wazuh-indexer<span class="w"> </span>/etc/wazuh-indexer/certs
</code></pre></div>
<p>Move each node’s certificate and key files (e.g., <code>node-1.pem</code> and <code>node-1-key.pem</code>) to their respective <code>certs</code> folder. These files are specific to each node and shouldn’t be shared with others. However, <strong>do not move</strong> the <code>root-ca.pem</code> certificate—<strong>copy</strong> it instead, so it can be deployed to other component folders later.</p>
<p>Edit <code>/etc/wazuh-indexer/opensearch.yml</code> and modify the following settings:</p>
<ol>
<li><strong><code>network.host</code></strong> – Defines the node’s address for HTTP and transport traffic. It should match the address used in <code>config.yml</code> when generating SSL certificates.</li>
<li><strong><code>node.name</code></strong> – Set this to the Wazuh indexer node name as defined in <code>config.yml</code> (e.g., <code>node-1</code>).</li>
<li><strong><code>cluster.initial_master_nodes</code></strong> – List the names of master-eligible nodes, as specified in <code>config.yml</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>network.host:<span class="w"> </span><span class="s2">&quot;10.0.0.20&quot;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>node.name:<span class="w"> </span><span class="s2">&quot;node-1&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>cluster.initial_master_nodes:
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>-<span class="w"> </span><span class="s2">&quot;node-1&quot;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c1">#- &quot;node-2&quot;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1">#- &quot;node-3&quot;</span>
</code></pre></div>
<ol>
<li><strong><code>discovery.seed_hosts</code></strong> – Contains the addresses of master-eligible nodes. Leave it commented for a single-node setup, but for multi-node configurations, uncomment it and specify the node addresses.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>discovery.seed_hosts:
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span>-<span class="w"> </span><span class="s2">&quot;10.0.0.1&quot;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span>-<span class="w"> </span><span class="s2">&quot;10.0.0.2&quot;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span>-<span class="w"> </span><span class="s2">&quot;10.0.0.3&quot;</span>
</code></pre></div>
<ol>
<li><strong><code>plugins.security.nodes_dn</code></strong> – Lists the Distinguished Names (DNs) of certificates for all Wazuh indexer cluster nodes. Uncomment and modify these based on your settings and <code>config.yml</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>plugins.security.nodes_dn:
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>-<span class="w"> </span><span class="s2">&quot;CN=node-1,OU=Wazuh,O=Wazuh,L=California,C=US&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>-<span class="w"> </span><span class="s2">&quot;CN=node-2,OU=Wazuh,O=Wazuh,L=California,C=US&quot;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>-<span class="w"> </span><span class="s2">&quot;CN=node-3,OU=Wazuh,O=Wazuh,L=California,C=US&quot;</span>
</code></pre></div>
<p>Enable and start the Wazuh indexer service. Verify Wazuh indexer is active and running (exit with <code>q</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>wazuh-indexer
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>systemctl<span class="w"> </span>start<span class="w"> </span>wazuh-indexer
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>systemctl<span class="w"> </span>status<span class="w"> </span>wazuh-indexer
</code></pre></div>
<p>Once all Wazuh indexer nodes are running, execute the <code>indexer-security-init.sh</code> script on <strong>any</strong> Wazuh indexer node. This updates the certificate information and initiates the cluster.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>/usr/share/wazuh-indexer/bin/indexer-security-init.sh
</code></pre></div>
<p>Run the following command to check that the installation is successful. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>curl<span class="w"> </span>-XGET<span class="w"> </span>https://10.0.0.20:9200<span class="w"> </span>-u<span class="w"> </span>admin:admin<span class="w"> </span>-k
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="o">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span><span class="s2">&quot;name&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;node-1&quot;</span>,
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="s2">&quot;cluster_name&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;wazuh-cluster&quot;</span>,
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="s2">&quot;cluster_uuid&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;6hQpHd5cSzCLrhFo0T-Crg&quot;</span>,
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="s2">&quot;version&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="s2">&quot;number&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;7.10.2&quot;</span>,
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="s2">&quot;build_type&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;rpm&quot;</span>,
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="s2">&quot;build_hash&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;eee49cb340edc6c4d489bcd9324dda571fc8dc03&quot;</span>,
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="s2">&quot;build_date&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;2023-09-20T23:54:29.889267151Z&quot;</span>,
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">    </span><span class="s2">&quot;build_snapshot&quot;</span><span class="w"> </span>:<span class="w"> </span>false,
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="s2">&quot;lucene_version&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;9.7.0&quot;</span>,
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="s2">&quot;minimum_wire_compatibility_version&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;7.10.0&quot;</span>,
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="s2">&quot;minimum_index_compatibility_version&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;7.0.0&quot;</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">  </span><span class="o">}</span>,
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">  </span><span class="s2">&quot;tagline&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;The OpenSearch Project: https://opensearch.org/&quot;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="o">}</span>
</code></pre></div>
<h3 id="installing-the-wazuh-server"><strong>Installing the Wazuh server</strong></h3>
<p>Run the following commands to import the Wazuh key and install the Wazuh manager.</p>
<p><strong>RPM:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>rpm<span class="w"> </span>--import<span class="w"> </span>./wazuh-offline/wazuh-files/GPG-KEY-WAZUH
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>rpm<span class="w"> </span>-ivh<span class="w"> </span>./wazuh-offline/wazuh-packages/wazuh-manager*.rpm
</code></pre></div>
<p><strong>DEB:</strong></p>
<p>On systems with <em>apt</em> as package manager, the following dependencies must be installed on the Wazuh server nodes.</p>
<ul>
<li>gnupg</li>
<li>apt-transport-https</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>dpkg<span class="w"> </span>-i<span class="w"> </span>./wazuh-offline/wazuh-packages/wazuh-manager*.deb
</code></pre></div>
<p>Store the Wazuh indexer username and password in the Wazuh manager keystore using the <code>wazuh-keystore</code> tool.</p>
<p><strong>Note:</strong> The default credentials for an offline installation are <strong>admin:admin</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;&lt;INDEXER_USERNAME&gt;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>/var/ossec/bin/wazuh-keystore<span class="w"> </span>-f<span class="w"> </span>indexer<span class="w"> </span>-k<span class="w"> </span>username
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;&lt;INDEXER_PASSWORD&gt;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>/var/ossec/bin/wazuh-keystore<span class="w"> </span>-f<span class="w"> </span>indexer<span class="w"> </span>-k<span class="w"> </span>password
</code></pre></div>
<p>Enable and start the Wazuh manager service. Verify Wazuh manager is active and running (exit with <code>q</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">manager</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">systemctl</span> <span class="n">start</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">manager</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">systemctl</span> <span class="n">status</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">manager</span>
</code></pre></div>
<h3 id="installing-filebeat"><strong>Installing Filebeat</strong></h3>
<p>Filebeat must be installed and configured on the same server as the Wazuh manager. Run the following command to install Filebeat.</p>
<p><strong>RPM:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">rpm</span> <span class="o">-</span><span class="n">ivh</span> <span class="o">./</span><span class="n">wazuh</span><span class="o">-</span><span class="n">offline</span><span class="o">/</span><span class="n">wazuh</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">filebeat</span><span class="o">*.</span><span class="n">rpm</span>
</code></pre></div>
<p><strong>DEB:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nx">dpkg</span><span class="w"> </span><span class="o">-</span><span class="nx">i</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="nx">wazuh</span><span class="o">-</span><span class="nx">offline</span><span class="o">/</span><span class="nx">wazuh</span><span class="o">-</span><span class="nx">packages</span><span class="o">/</span><span class="nx">filebeat</span><span class="o">*</span><span class="p">.</span><span class="nx">deb</span>
</code></pre></div>
<p>Copy the configuration files to the correct location. When prompted, type <strong>"yes"</strong> to overwrite <code>/etc/filebeat/filebeat.yml</code>.</p>
<p><strong>Note for CentOS:</strong> Remove <code>&amp;&amp;\</code> from the command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>cp<span class="w"> </span>./wazuh-offline/wazuh-files/filebeat.yml<span class="w"> </span>/etc/filebeat/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="se">\</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>cp<span class="w"> </span>./wazuh-offline/wazuh-files/wazuh-template.json<span class="w"> </span>/etc/filebeat/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="se">\</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>chmod<span class="w"> </span>go+r<span class="w"> </span>/etc/filebeat/wazuh-template.json
</code></pre></div>
<p>Edit the <code>/etc/filebeat/filebeat.yml</code> configuration file and replace the following value:</p>
<p><code>hosts</code>: The list of Wazuh indexer nodes to connect to. You can use either IP addresses or hostnames. By default, the host is set to localhost <code>hosts: ["127.0.0.1:9200"]</code>. Replace it with your Wazuh indexer address accordingly. </p>
<p>If you have more than one Wazuh indexer node, you can separate the addresses using commas. For example, <code>hosts: ["10.0.0.1:9200", "10.0.0.2:9200", "10.0.0.3:9200"]</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Wazuh - Filebeat configuration file</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w"> </span>output.elasticsearch:
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w"> </span>hosts:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.0.0.20:9200&quot;</span><span class="o">]</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w"> </span>protocol:<span class="w"> </span>https
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w"> </span>username:<span class="w"> </span><span class="si">${</span><span class="nv">username</span><span class="si">}</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w"> </span>password:<span class="w"> </span><span class="si">${</span><span class="nv">password</span><span class="si">}</span>
</code></pre></div>
<p>Create a Filebeat keystore to securely store authentication credentials.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>filebeat<span class="w"> </span>keystore<span class="w"> </span>create
</code></pre></div>
<p>Add the username and password <code>admin</code>:<code>admin</code> to the secrets keystore.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nb">echo</span><span class="w"> </span>admin<span class="w"> </span><span class="p">|</span><span class="w"> </span>filebeat<span class="w"> </span>keystore<span class="w"> </span>add<span class="w"> </span>username<span class="w"> </span>--stdin<span class="w"> </span>--force
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="nb">echo</span><span class="w"> </span>admin<span class="w"> </span><span class="p">|</span><span class="w"> </span>filebeat<span class="w"> </span>keystore<span class="w"> </span>add<span class="w"> </span>password<span class="w"> </span>--stdin<span class="w"> </span>--force
</code></pre></div>
<p>Install the Wazuh module for Filebeat.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>tar<span class="w"> </span>-xzf<span class="w"> </span>./wazuh-offline/wazuh-files/wazuh-filebeat-0.4.tar.gz<span class="w"> </span>-C<span class="w"> </span>/usr/share/filebeat/module
</code></pre></div>
<p>Replace <code>&lt;SERVER_NODE_NAME&gt;</code> with your Wazuh server node certificate name, the same used in <code>config.yml</code> when creating the certificates. For example, <code>wazuh-1</code>. Then, move the certificates to their corresponding location.</p>
<p>On CentOS, if you encounter the error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>chmod:<span class="w"> </span>cannot<span class="w"> </span>access<span class="w"> </span><span class="s1">&#39;/etc/filebeat/certs/*&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directorty
</code></pre></div>
<p>Navigate to <code>/etc/filebeat/certs/</code> and run <code>chmod 400 *</code> as a root user</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nv">NODE_NAME</span><span class="o">=</span>&lt;SERVER_NODE_NAME&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>mkdir<span class="w"> </span>/etc/filebeat/certs
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>mv<span class="w"> </span>-n<span class="w"> </span>wazuh-install-files/<span class="nv">$NODE_NAME</span>.pem<span class="w"> </span>/etc/filebeat/certs/filebeat.pem
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>mv<span class="w"> </span>-n<span class="w"> </span>wazuh-install-files/<span class="nv">$NODE_NAME</span>-key.pem<span class="w"> </span>/etc/filebeat/certs/filebeat-key.pem
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>cp<span class="w"> </span>wazuh-install-files/root-ca.pem<span class="w"> </span>/etc/filebeat/certs/
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>chmod<span class="w"> </span><span class="m">500</span><span class="w"> </span>/etc/filebeat/certs
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/etc/filebeat/certs/*
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>chown<span class="w"> </span>-R<span class="w"> </span>root:root<span class="w"> </span>/etc/filebeat/certs
</code></pre></div>
<p>Enable and start the Filebeat service. Verify Filebeat is active and running (exit with <code>q</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>filebeat
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>systemctl<span class="w"> </span>start<span class="w"> </span>filebeat
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>systemctl<span class="w"> </span>status<span class="w"> </span>filebeat
</code></pre></div>
<p>Run the following command to make sure Filebeat is successfully installed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>filebeat<span class="w"> </span><span class="nb">test</span><span class="w"> </span>output
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>elasticsearch:<span class="w"> </span>https://10.0.0.20:9200...
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">  </span>parse<span class="w"> </span>url...<span class="w"> </span>OK
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">  </span>connection...
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span>parse<span class="w"> </span>host...<span class="w"> </span>OK
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span>dns<span class="w"> </span>lookup...<span class="w"> </span>OK
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span>addresses:<span class="w"> </span><span class="m">10</span>.0.0.20
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span>dial<span class="w"> </span>up...<span class="w"> </span>OK
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">  </span>TLS...
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">    </span>security:<span class="w"> </span>server<span class="err">&#39;</span>s<span class="w"> </span>certificate<span class="w"> </span>chain<span class="w"> </span>verification<span class="w"> </span>is<span class="w"> </span>enabled
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">    </span>handshake...<span class="w"> </span>OK
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">    </span>TLS<span class="w"> </span>version:<span class="w"> </span>TLSv1.3
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span>dial<span class="w"> </span>up...<span class="w"> </span>OK
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">  </span>talk<span class="w"> </span>to<span class="w"> </span>server...<span class="w"> </span>OK
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">  </span>version:<span class="w"> </span><span class="m">7</span>.10.2
</code></pre></div>
<p>Wazuh server node is now successfully installed.</p>
<h3 id="installing-the-wazuh-dashboard"><strong>Installing the Wazuh Dashboard</strong></h3>
<p><strong>RPM:</strong></p>
<p>The following dependencies must be installed on the Wazuh dashboard node.</p>
<ul>
<li>libcap</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>rpm<span class="w"> </span>--import<span class="w"> </span>./wazuh-offline/wazuh-files/GPG-KEY-WAZUH
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>rpm<span class="w"> </span>-ivh<span class="w"> </span>./wazuh-offline/wazuh-packages/wazuh-dashboard*.rpm
</code></pre></div>
<p><strong>DEB:</strong></p>
<p>The following dependencies must be installed on the Wazuh dashboard node.</p>
<ul>
<li>debhelper version 9 or later</li>
<li>tar</li>
<li>curl</li>
<li>libcap2-bin</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>dpkg<span class="w"> </span>-i<span class="w"> </span>./wazuh-offline/wazuh-packages/wazuh-dashboard*.deb
</code></pre></div>
<p>Replace <code>&lt;DASHBOARD_NODE_NAME&gt;</code> with your Wazuh dashboard node name, the same used in <code>config.yml</code> to create the certificates. For example, <code>dashboard</code>. Then, move the certificates to their corresponding location.</p>
<p>On CentOS, if you encounter the error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>chmod:<span class="w"> </span>cannot<span class="w"> </span>access<span class="w"> </span><span class="s1">&#39;/etc/wazuh-dashboard/certs/*&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directorty
</code></pre></div>
<p>Navigate to <code>/etc/wazuh-dashboard/certs/</code> and run <code>chmod 400 *</code> as a root user</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nv">NODE_NAME</span><span class="o">=</span>&lt;DASHBOARD_NODE_NAME&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>mkdir<span class="w"> </span>/etc/wazuh-dashboard/certs
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>mv<span class="w"> </span>-n<span class="w"> </span>wazuh-install-files/<span class="nv">$NODE_NAME</span>.pem<span class="w"> </span>/etc/wazuh-dashboard/certs/dashboard.pem
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>mv<span class="w"> </span>-n<span class="w"> </span>wazuh-install-files/<span class="nv">$NODE_NAME</span>-key.pem<span class="w"> </span>/etc/wazuh-dashboard/certs/dashboard-key.pem
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>cp<span class="w"> </span>wazuh-install-files/root-ca.pem<span class="w"> </span>/etc/wazuh-dashboard/certs/
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>chmod<span class="w"> </span><span class="m">500</span><span class="w"> </span>/etc/wazuh-dashboard/certs
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/etc/wazuh-dashboard/certs/*
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>chown<span class="w"> </span>-R<span class="w"> </span>wazuh-dashboard:wazuh-dashboard<span class="w"> </span>/etc/wazuh-dashboard/certs
</code></pre></div>
<p>Edit the <code>/etc/wazuh-dashboard/opensearch_dashboards.yml</code> file and replace the following values:</p>
<ol>
<li><code>server.host</code>: This setting specifies the host of the back end server. To allow remote users to connect, set the value to the IP address or DNS name of the Wazuh dashboard. The value <code>0.0.0.0</code> will accept all the available IP addresses of the host.</li>
<li><code>opensearch.hosts</code>: The URLs of the Wazuh indexer instances to use for all your queries. The Wazuh dashboard can be configured to connect to multiple Wazuh indexer nodes in the same cluster. The addresses of the nodes can be separated by commas. For example, <code>["https://10.0.0.2:9200", "https://10.0.0.3:9200","https://10.0.0.4:9200"]</code></li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>server.host:<span class="w"> </span><span class="m">10</span>.0.0.20
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>server.port:<span class="w"> </span><span class="m">443</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>opensearch.hosts:<span class="w"> </span>https://10.0.0.20:9200
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>opensearch.ssl.verificationMode:<span class="w"> </span>certificate
</code></pre></div>
<p>Enable and start the Wazuh dashboard. Verify Wazuh dashboard is active and running (exit with <code>q</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>wazuh-dashboard
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>systemctl<span class="w"> </span>start<span class="w"> </span>wazuh-dashboard
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>systemctl<span class="w"> </span>status<span class="w"> </span>wazuh-dashboard
</code></pre></div>
<p>Edit the file <code>/usr/share/wazuh-dashboard/data/wazuh/config/wazuh.yml</code> and replace the <code>url</code> value with the IP address or hostname of the Wazuh server master node.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>hosts:
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span>-<span class="w"> </span>default:
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">      </span>url:<span class="w"> </span>https://10.0.0.20
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">      </span>port:<span class="w"> </span><span class="m">55000</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">      </span>username:<span class="w"> </span>wazuh-wui
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">      </span>password:<span class="w"> </span>wazuh-wui
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">      </span>run_as:<span class="w"> </span><span class="nb">false</span>
</code></pre></div>
<p>Access the web interface.</p>
<ul>
<li>URL: <em>https://<WAZUH_DASHBOARD_IP_ADDRESS></em></li>
<li><strong>Username</strong>: admin</li>
<li><strong>Password</strong>: admin</li>
</ul>
<p><a class="glightbox" href="image.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image.png" /></a></p>
<h3 id="importing-certificate-optional"><strong>Importing Certificate (Optional)</strong></h3>
<p>Upon the first access to the Wazuh dashboard, the browser shows a warning message stating that the certificate was not issued by a trusted authority. An exception can be added in the advanced options of the web browser or, for increased security, the <code>root-ca.pem</code> file previously generated can be imported to the certificate manager of the browser. </p>
<p>Copy /etc/wazuh-dashboard/certs/root-ca.pem to user’s home directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>cp<span class="w"> </span>/etc/wazuh-dashboard/certs/root-ca.pem<span class="w"> </span>~/
</code></pre></div>
<p>Change ownership of user's home directory to the non-root user to enable read access to <code>root-ca.pem</code></p>
<p>On Firefox, go to Settings, Privacy &amp; Security and Certificates. Click View Certificates.</p>
<p><a class="glightbox" href="image%201.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%201.png" /></a></p>
<p>Click Import, select <code>root-ca.pem</code> in user’s home directory. Select Trust this CA to identify website and email users. Click OK.</p>
<p><a class="glightbox" href="image%202.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%202.png" /></a></p>
<p>Delete root-ca.pem from user’s home directory.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">sudo</span> <span class="n">rm</span> <span class="n">root</span><span class="o">-</span><span class="n">ca</span><span class="o">.</span><span class="n">pem</span>
</code></pre></div>
<h3 id="securing-wazuh-installation-optional"><strong>Securing Wazuh Installation (Optional)</strong></h3>
<p>You have now installed and configured all the Wazuh central components. We recommend changing the default credentials to protect your infrastructure from possible attacks.</p>
<p>Use the Wazuh passwords tool to change all the internal users passwords.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>/usr/share/wazuh-indexer/plugins/opensearch-security/tools/wazuh-passwords-tool.sh<span class="w"> </span>--api<span class="w"> </span>--change-all<span class="w"> </span>--admin-user<span class="w"> </span>wazuh<span class="w"> </span>--admin-password<span class="w"> </span>wazuh
</code></pre></div>
<p>Save the new Wazuh indexer password into the Wazuh manager keystore. Restart Wazuh manager service.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>/var/ossec/bin/wazuh-keystore<span class="w"> </span>-f<span class="w"> </span>indexer<span class="w"> </span>-k<span class="w"> </span>password<span class="w"> </span>-v<span class="w"> </span>&lt;SNIP&gt;
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>systemctl<span class="w"> </span>start<span class="w"> </span>wazuh-manager
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>systemctl<span class="w"> </span>status<span class="w"> </span>wazuh-manager
</code></pre></div>
<p>Add the new password to the Filebeat secrets keystore. Restart the Filebeat service</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">echo</span> <span class="s2">&quot;&lt;SNIP&gt;&quot;</span> <span class="o">|</span> <span class="n">filebeat</span> <span class="n">keystore</span> <span class="n">add</span> <span class="n">password</span> <span class="o">--</span><span class="n">stdin</span> <span class="o">--</span><span class="n">force</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">filebeat</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">filebeat</span> <span class="n">test</span> <span class="n">output</span>
</code></pre></div>
<p>Verify that new password has been added to /usr/share/wazuh-dashboard/data/wazuh/config/wazuh.yml. Restart the Wazuh dashboard.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">nano</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wazuh</span><span class="o">-</span><span class="n">dashboard</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">wazuh</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">wazuh</span><span class="o">.</span><span class="n">yml</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">dashboard</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="n">systemctl</span> <span class="n">status</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">dashboard</span>
</code></pre></div>
<h2 id="installing-wazuh-agents-on-endpoints"><strong>Installing Wazuh Agents on Endpoints</strong></h2>
<h3 id="configuring-firewall-on-windows"><strong>Configuring Firewall on Windows</strong></h3>
<p>For Wazuh agent to communicate with the Wazuh manager services, the following ports needs to be allowed for outbound connection:</p>
<ul>
<li>1514/TCP for agent communication.</li>
<li>1515/TCP for enrollment via automatic agent request.</li>
<li>55000/TCP for enrollment via manager API.</li>
</ul>
<p>Open Windows Defender Firewall with Advanced Security. Right-click Outbound Rules and create new rule. Select Port.</p>
<p><a class="glightbox" href="image%203.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%203.png" /></a></p>
<p>Select TCP and Specific remote ports. Put 1514, 1515, 55000. Click Next.</p>
<p><a class="glightbox" href="image%204.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%204.png" /></a></p>
<p>Select Allow the connection.</p>
<p><a class="glightbox" href="image%205.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%205.png" /></a></p>
<p>Select Domain, Private and Public.</p>
<p><a class="glightbox" href="image%206.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%206.png" /></a></p>
<p>Name the New Outbound Rule as Wazuh outbound and click Finish.</p>
<p><a class="glightbox" href="image%207.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%207.png" /></a></p>
<h3 id="installing-wazuh-agent-on-windows"><strong>Installing Wazuh agent on Windows</strong></h3>
<p>The agent runs on the endpoint you want to monitor and communicates with the Wazuh server, sending data in near real-time through an encrypted and authenticated channel.</p>
<p>Note To perform the installation, administrator privileges are required.</p>
<p>To start the installation process, download the <a href="https://packages.wazuh.com/4.x/windows/wazuh-agent-4.11.0-1.msi">Windows installer</a>.</p>
<p>Open PowerShell as Administrator and change directory to where Windows installer is located. Run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="p">.\</span><span class="n">wazuh-agent</span><span class="p">-</span><span class="n">4</span><span class="p">.</span><span class="n">11</span><span class="p">.</span><span class="n">0</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">msi</span> <span class="p">/</span><span class="n">q</span> <span class="n">WAZUH_MANAGER</span><span class="p">=</span><span class="s2">&quot;10.0.0.20&quot;</span>
</code></pre></div>
<p>The installation process is now complete, and the Wazuh agent is successfully installed and configured. You can start the Wazuh agent from the GUI or by running:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">NET</span> <span class="nb">START </span><span class="n">Wazuh</span>
</code></pre></div>
<p>Once started, the Wazuh agent will start the enrollment process and register with the manager.</p>
<h3 id="troubleshooting-windows-wazuh-agent"><strong>Troubleshooting Windows Wazuh Agent</strong></h3>
<p>If Wazuh agent on Windows is unable to connect to Wazuh server, open Wazuh Agent Manager</p>
<p>If Authentication key show as <insert_auth_key_here>, click Manage then Restart</p>
<p>Click Save then Refresh</p>
<p><a class="glightbox" href="image%208.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%208.png" /></a></p>
<p>You should be able to see Authentication key. The Authentication key is used to encrypt the traffic from the agent to the Wazuh server.</p>
<p>If issues still persist, refer to the log file located at <code>C:\Program Files (x86)\ossec-agent\ossec.log</code></p>
<p>Alternatively, refer to the <a href="https://documentation.wazuh.com/current/user-manual/agent/agent-enrollment/troubleshooting.html">Troubleshooting guide</a>.</p>
<p><a class="glightbox" href="image%209.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%209.png" /></a></p>
<p>On Wazuh web UI, go to Server management, then Endpoints Summary.</p>
<p>Verify that the Windows agent is active.</p>
<p><a class="glightbox" href="image%2010.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2010.png" /></a></p>
<h3 id="sysmon-integration"><strong>Sysmon Integration</strong></h3>
<p>Perform the steps below to install and configure Sysmon on the Windows endpoint.</p>
<p>Download Sysmon from the <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Microsoft Sysinternals page</a>.</p>
<p>Download the Sysmon configuration file: <a href="https://wazuh.com/resources/blog/detecting-process-injection-with-wazuh/sysmonconfig.xml">sysmonconfig.xml</a>. Note this is a modified version of sysmonconfig.xml recommended for integration with Wazuh. </p>
<p>Install Sysmon with the downloaded configuration file using PowerShell as an administrator:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="o">.</span>\<span class="n">sysmon64</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">accepteula</span> <span class="o">-</span><span class="n">i</span> <span class="o">.</span>\<span class="n">sysmonconfig</span><span class="o">.</span><span class="n">xml</span>
</code></pre></div>
<p>Open notepad as Administrator and open <code>ossec.conf</code>.</p>
<p>Add the following configuration within the <code>&lt;ossec_config&gt;</code> block to the Wazuh agent <code>C:\Program Files (x86)\ossec-agent\ossec.conf</code> file to specify the location to collect Sysmon logs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="o">&lt;</span><span class="n">localfile</span><span class="o">&gt;</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>  <span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="n">Microsoft</span><span class="o">-</span><span class="n">Windows</span><span class="o">-</span><span class="n">Sysmon</span><span class="o">/</span><span class="n">Operational</span><span class="o">&lt;/</span><span class="n">location</span><span class="o">&gt;</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>  <span class="o">&lt;</span><span class="n">log_format</span><span class="o">&gt;</span><span class="n">eventchannel</span><span class="o">&lt;/</span><span class="n">log_format</span><span class="o">&gt;</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="o">&lt;/</span><span class="n">localfile</span><span class="o">&gt;</span>
</code></pre></div>
<p>Restart the Wazuh agent to apply the changes by running the following PowerShell command as an administrator:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">Restart</span><span class="o">-</span><span class="n">Service</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Wazuh</span>
</code></pre></div>
<h2 id="monitoring-network-devices-with-wazuh"><strong>Monitoring Network Devices with Wazuh</strong></h2>
<h3 id="configuring-syslog-logging-on-fortigate"><strong>Configuring Syslog Logging on FortiGate</strong></h3>
<p>On FortiGate Command-Line Interface (CLI), run the following commands to configure Syslog Server Settings:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>config<span class="w"> </span>log<span class="w"> </span>syslogd<span class="w"> </span>setting
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>status<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>server<span class="w"> </span>&lt;syslog-ng<span class="w"> </span>IP&gt;
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>source-ip<span class="w"> </span>&lt;FortiGate<span class="w"> </span>IP&gt;
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">    </span><span class="c1"># set port &lt;port number&gt;  (Default port is 514)</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">    </span><span class="c1"># Verify settings by running &quot;show&quot;</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>end
</code></pre></div>
<p>Configure Log Memory Filter:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>config<span class="w"> </span>log<span class="w"> </span>memory<span class="w"> </span>filter
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>forward-traffic<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>local-traffic<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>sniffer-traffic<span class="w"> </span>disable
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>anomaly<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>voip<span class="w"> </span>disable
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>multicast-traffic<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">    </span><span class="c1"># Verify settings by running &quot;show full-configuration&quot;</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>end
</code></pre></div>
<p>Configure Global System Settings:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>config<span class="w"> </span>system<span class="w"> </span>global
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>cli-audit-log<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="c1"># Verify settings by running &quot;show&quot;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="c1"># Ensure the timezone is correct, e.g., &quot;Pacific/Auckland&quot;</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>end
</code></pre></div>
<p>Enable Logging for Neighbour Events:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>config<span class="w"> </span>log<span class="w"> </span>setting
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">    </span><span class="nb">set</span><span class="w"> </span>neighbor-event<span class="w"> </span><span class="nb">enable</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>end
</code></pre></div>
<h3 id="configuring-log-rotation"><strong>Configuring Log Rotation</strong></h3>
<p>By default, the <code>logrotate</code> service is configured to rotate logs in directories like <code>/var/log/</code></p>
<p>For <code>rsyslog</code>, the rotation of its default log files (e.g., <code>/var/log/syslog</code>) is managed by the configuration file located at <code>/etc/logrotate.d/rsyslog</code>.
Open the /etc/logrotate.d/rsyslog file in a text editor:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/logrotate.d/rsyslog
</code></pre></div>
<p>Add the path to your <code>fortigate.log</code> file under the existing log files. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>/var/log/syslog
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>/var/log/fortigate.log
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>...
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="o">{</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">    </span>rotate<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">    </span>weekly
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">    </span>missingok
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">    </span>notifempty
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">    </span>compress
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">    </span>delaycompress
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">    </span>sharedscripts
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">    </span>postrotate
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w">        </span>/usr/lib/rsyslog/rsyslog-rotate
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="w">    </span>endscript
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="o">}</span>
</code></pre></div>
<p><strong>Key Settings:</strong></p>
<ul>
<li><strong>rotate 4</strong>: Keeps 4 log files before deleting the oldest one.</li>
<li><strong>weekly</strong>: Rotates logs once per week.</li>
<li><strong>missingok</strong>: If the log file is missing, no error will be raised.</li>
<li><strong>notifempty</strong>: Only rotates logs if they are not empty.</li>
<li><strong>compress</strong>: Compresses old log files (e.g., to <code>.gz</code>).</li>
<li><strong>delaycompress</strong>: Compresses the logs on the second rotation cycle, meaning the most recent rotated file is not compressed immediately.</li>
<li><strong>sharedscripts</strong>: Runs the <code>postrotate</code> script only once, even if multiple logs are rotated.</li>
<li><strong>postrotate</strong>: After log rotation, it runs <code>/usr/lib/rsyslog/rsyslog-rotate</code> to ensure that <code>rsyslog</code> reopens its log files (so it doesn't keep writing to the old rotated file).</li>
</ul>
<h3 id="configuring-syslog-on-wazuh-server-optional"><strong>Configuring Syslog on Wazuh Server (Optional)</strong></h3>
<p>The <strong>Wazuh server</strong> can collect logs via syslog from endpoints such as firewalls, switches, routers, and other devices that don’t support the installation of Wazuh agents. More details can be found <a href="https://documentation.wazuh.com/current/user-manual/capabilities/log-data-collection/syslog.html">here</a>.</p>
<p>If you have a central logging server like Syslog or Logstash in place, you can install the Wazuh agent on that server to streamline log collection. This setup enables seamless forwarding of logs from multiple sources to the Wazuh server, facilitating comprehensive analysis.</p>
<h3 id="configure-rsyslog-on-ubuntu-endpoint-recommended"><strong>Configure Rsyslog on Ubuntu endpoint (Recommended)</strong></h3>
<p><strong>Rsyslog</strong> is a preinstalled utility in Ubuntu 22.04 for receiving syslog events. The following section shows the steps for enabling Rsyslog on the Ubuntu endpoint and configuring the Wazuh agent to send the syslog log data to the Wazuh server.</p>
<p>Edit /etc/rsyslog.conf. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>nano<span class="w"> </span>/etc/rsyslog.conf
</code></pre></div>
<p>Uncomment udp/514. Add allowed sender and configure log file format. Save changes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1">#provides UDP syslog reception</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>module<span class="o">(</span><span class="nv">load</span><span class="o">=</span>”imudp”<span class="o">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>input<span class="o">(</span><span class="nv">type</span><span class="o">=</span>”imudp”<span class="w"> </span><span class="nv">port</span><span class="o">=</span>”514<span class="s2">&quot;)</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="s2">#Add allowed sender and configure log file format</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="nv">$AllowedSender</span><span class="s2"> UDP, 10.0.0.1/24</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="nv">$template</span><span class="s2"> remote-incoming-logs, &quot;</span>/var/log/%HOSTNAME%.log<span class="s2">&quot;</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="s2">*.* ?remote-incoming-logs</span>
</code></pre></div>
<p>Permit udp/514 through the firewall (if firewall is configured and enabled).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="mi">514</span><span class="o">/</span><span class="n">udp</span>
</code></pre></div>
<p>Edit permissions on <code>/var/log</code> as Rsyslog may encounter permission error on relaunch. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span>/var/log
</code></pre></div>
<p>Add any hosts you are receiving logs from to <code>/etc/hosts</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/hosts
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="m">10</span>.0.0.1<span class="w">    </span>Fortigate
</code></pre></div>
<p>Restart and check status of rsyslog.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>rsyslog
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>systemctl<span class="w"> </span>status<span class="w"> </span>rsyslog
</code></pre></div>
<p>Configure the syslog clients (network devices) to send logs to our syslog server. Check <code>/var/log</code> to see that new log files are updating.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>ls<span class="w"> </span>/var/log
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>cat<span class="w"> </span>fortigate.log
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="m">2024</span>-09-13T08:13:46.806479+12:00<span class="w"> </span>fortigate<span class="w"> </span><span class="nv">date</span><span class="o">=</span><span class="m">2024</span>-09-12<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">15</span>:44:50<span class="w"> </span><span class="nv">devname</span><span class="o">=</span><span class="s2">&quot;Fortigate&quot;</span><span class="w"> </span><span class="nv">devid</span><span class="o">=</span><span class="s2">&quot;FGVMEVUEOETC5XC8&quot;</span><span class="w"> </span><span class="nv">eventtime</span><span class="o">=</span><span class="m">1726112689938988753</span><span class="w"> </span><span class="nv">tz</span><span class="o">=</span><span class="s2">&quot;+1200&quot;</span><span class="w"> </span><span class="nv">logid</span><span class="o">=</span><span class="s2">&quot;0001000014&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;traffic&quot;</span><span class="w"> </span><span class="nv">subtype</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="w"> </span><span class="nv">level</span><span class="o">=</span><span class="s2">&quot;notice&quot;</span><span class="w"> </span><span class="nv">vd</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="w"> </span><span class="nv">srcip</span><span class="o">=</span><span class="m">192</span>.168.1.64<span class="w"> </span><span class="nv">srcport</span><span class="o">=</span><span class="m">14712</span><span class="w"> </span><span class="nv">srcintf</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="w"> </span><span class="nv">srcintfrole</span><span class="o">=</span><span class="s2">&quot;undefined&quot;</span><span class="w"> </span><span class="nv">dstip</span><span class="o">=</span><span class="m">38</span>.21.192.5<span class="w"> </span><span class="nv">dstport</span><span class="o">=</span><span class="m">443</span><span class="w"> </span><span class="nv">dstintf</span><span class="o">=</span><span class="s2">&quot;port1&quot;</span><span class="w"> </span><span class="nv">dstintfrole</span><span class="o">=</span><span class="s2">&quot;wan&quot;</span><span class="w"> </span><span class="nv">srccountry</span><span class="o">=</span><span class="s2">&quot;Reserved&quot;</span><span class="w"> </span><span class="nv">dstcountry</span><span class="o">=</span><span class="s2">&quot;United States&quot;</span><span class="w"> </span><span class="nv">sessionid</span><span class="o">=</span><span class="m">44992</span><span class="w"> </span><span class="nv">proto</span><span class="o">=</span><span class="m">6</span><span class="w"> </span><span class="nv">action</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="w"> </span><span class="nv">policyid</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">service</span><span class="o">=</span><span class="s2">&quot;HTTPS&quot;</span><span class="w"> </span><span class="nv">trandisp</span><span class="o">=</span><span class="s2">&quot;noop&quot;</span><span class="w"> </span><span class="nv">app</span><span class="o">=</span><span class="s2">&quot;HTTPS&quot;</span><span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">sentbyte</span><span class="o">=</span><span class="m">441</span><span class="w"> </span><span class="nv">rcvdbyte</span><span class="o">=</span><span class="m">223</span><span class="w"> </span><span class="nv">sentpkt</span><span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="nv">rcvdpkt</span><span class="o">=</span><span class="m">4</span>
</code></pre></div>
<h3 id="installing-wazuh-agent-on-linux-ubuntu"><strong>Installing Wazuh agent on Linux (Ubuntu)</strong></h3>
<p>Configure firewall:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">55000</span>/tcp
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">1514</span>/tcp
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">1515</span>/tcp
</code></pre></div>
<p>Download Wazuh agent from the <a href="https://documentation.wazuh.com/current/installation-guide/packages-list.html">packages list</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>https://packages.wazuh.com/4.x/apt/pool/main/w/wazuh-indexer/wazuh-indexer_4.11.0-1_amd64.deb
</code></pre></div>
<p>Transfer the Wazuh agent to Ubuntu endpoint. Install the package using <code>dpkg</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">agent_4</span><span class="mf">.11.0</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
</code></pre></div>
<p>After installing, set the Wazuh manager's IP address by editing the configuration file. Look for the <code>&lt;server&gt;</code> section and update it with the Wazuh manager's IP address.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>nano<span class="w"> </span>/var/ossec/etc/ossec.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>&lt;ossec_config&gt;
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">  </span>&lt;client&gt;
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">    </span>&lt;server&gt;
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">      </span>&lt;address&gt;10.0.0.20&lt;/address&gt;
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">      </span>&lt;port&gt;1514&lt;/port&gt;
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">      </span>&lt;protocol&gt;tcp&lt;/protocol&gt;
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="w">    </span>&lt;/server&gt;
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="w">    </span>&lt;config-profile&gt;ubuntu,<span class="w"> </span>ubuntu22,<span class="w"> </span>ubuntu22.04&lt;/config-profile&gt;
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="w">    </span>&lt;notify_time&gt;10&lt;/notify_time&gt;
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">    </span>&lt;time-reconnect&gt;60&lt;/time-reconnect&gt;
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">    </span>&lt;auto_restart&gt;yes&lt;/auto_restart&gt;
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">    </span>&lt;crypto_method&gt;aes&lt;/crypto_method&gt;
<a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">  </span>&lt;/client&gt;
</code></pre></div>
<p>Start and enable the Wazuh agent. Verify Wazuh agent is active and running.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>systemctl<span class="w"> </span>start<span class="w"> </span>wazuh-agent
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>wazuh-agent
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>systemctl<span class="w"> </span>status<span class="w"> </span>wazuh-agent
</code></pre></div>
<p>On Wazuh server UI, verify Ubuntu agent is active</p>
<p><a class="glightbox" href="image%2011.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2011.png" /></a></p>
<h3 id="configuring-wazuh-to-monitor-fortigate-log"><strong>Configuring Wazuh to Monitor Fortigate Log</strong></h3>
<p>Add the following to <code>/var/ossec/etc/ossec.conf</code> file on Wazuh manager and agent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1">#On both Wazuh manager and agent</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>&lt;localfile&gt;
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">  </span>&lt;log_format&gt;syslog&lt;/log_format&gt;
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">  </span>&lt;location&gt;/var/log/fortigate.log&lt;/location&gt;
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>&lt;/localfile&gt;
</code></pre></div>
<p>Restart the manager and agent after adding this setting:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-manager
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-agent
</code></pre></div>
<p>Verify fortigate logs are being ingested. <strong>Follow the steps below to enable archiving and set up wazuh-archives-* index.</strong> Search wazuh-alerts-<em> and wazuh-archives-</em> index. Add filter for location is <code>/var/log/fortigate.log</code>.</p>
<p><a class="glightbox" href="image%2012.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2012.png" /></a></p>
<p><a class="glightbox" href="image%2013.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2013.png" /></a></p>
<h3 id="default-decoders-and-rules-for-fortigate"><strong>Default Decoders and Rules for FortiGate</strong></h3>
<p>By default, Wazuh has pre-installed decoders and rules for FortiGate. This can be checked in Wazuh server UI under Rules and Decoders</p>
<p><a class="glightbox" href="image%2014.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2014.png" /></a></p>
<p><a class="glightbox" href="image%2015.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2015.png" /></a></p>
<p>To test the default rule for FortiGate, SSH brute force attack was executed from Kali machine.</p>
<p>The alert from the rule “Fortigate: Multiple high traffic events from same source” was generated.</p>
<p>This can be verified in Threat Intelligent, Events section on the web UI. </p>
<p><a class="glightbox" href="image%2016.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2016.png" /></a></p>
<h2 id="event-logging"><strong>Event Logging</strong></h2>
<h3 id="log-compression-and-rotation"><strong>Log Compression and Rotation</strong></h3>
<p>Log files can quickly accumulate and consume significant disk space in a system. To prevent this, the Wazuh manager compresses logs during its rotation process, helping to manage disk usage efficiently and maintain system performance. The Wazuh manager compresses log files daily or when they reach a certain threshold (file size, age, time, and more) and archives them. In the log rotation process, Wazuh creates a new log file with the original name to continuously write new events.</p>
<p>Log files are compressed daily and digitally signed using MD5, SHA1, and SHA256 hashing algorithms. The compressed log files are stored in the <code>/var/ossec/logs/</code> directory</p>
<h3 id="archiving-event-logs"><strong>Archiving Event Logs</strong></h3>
<p>Events are logs generated by applications, endpoints, and network devices. The Wazuh server stores all events it receives, whether or not they trigger a rule. These events are stored in the Wazuh archives located at <code>/var/ossec/logs/archives/archives.log</code> and <code>/var/ossec/logs/archives/archives.json</code>. Security teams use archived logs to review historical data of security incidents, analyze trends, and generate reports to hunt threats.</p>
<p>By default, the Wazuh archives are disabled because it stores logs indefinitely on the Wazuh server. When enabled, the Wazuh manager creates archived files to store and retain security data for compliance and forensic purposes.</p>
<p><strong>Note:</strong> The Wazuh archives retain logs collected from all monitored endpoints, therefore consuming significant storage resources on the Wazuh server over time. So, it is important to consider the impact on disk space and performance before enabling them.</p>
<h3 id="enabling-archiving"><strong>Enabling archiving</strong></h3>
<p>Edit the <strong>Wazuh manager</strong> configuration file <code>/var/ossec/etc/ossec.conf</code> and set the value of the highlighted fields below to <code>yes</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>&lt;ossec_config&gt;
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">  </span>&lt;global&gt;
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w">    </span>&lt;jsonout_output&gt;yes&lt;/jsonout_output&gt;
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">    </span>&lt;alerts_log&gt;yes&lt;/alerts_log&gt;
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">    </span>&lt;logall&gt;yes&lt;/logall&gt;
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">    </span>&lt;logall_json&gt;yes&lt;/logall_json&gt;
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>&lt;/ossec_config&gt;
</code></pre></div>
<p><code>&lt;logall&gt;</code> enables or disables archiving of all log messages. When enabled, the Wazuh server stores the logs in a syslog format. The allowed values are <code>yes</code> and <code>no</code>.<code>&lt;logall_json&gt;</code> enables or disables logging of events. When enabled, the Wazuh server stores the events in a JSON format. The allowed values are <code>yes</code> and <code>no</code>.</p>
<p>Depending on the format you desire, you can set one or both values of the highlighted fields to <code>yes</code>. However, only the <code>&lt;logall_json&gt;yes&lt;/logall_json&gt;</code> option allows you to create an index that can be used to visualize the events on the Wazuh dashboard.</p>
<p>Restart the Wazuh manager to apply the configuration changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">wazuh</span><span class="o">-</span><span class="n">manager</span>
</code></pre></div>
<p>Depending on your chosen format, the file <code>archives.log</code>, <code>archives.json</code>, or both will be created in the <code>/var/ossec/logs/archives/</code> directory on the Wazuh server. Wazuh uses a default log rotation policy. It ensures that available disk space is conserved by rotating and compressing logs on a daily, monthly, and yearly basis.</p>
<h3 id="visualising-events-on-dashboard"><strong>Visualising Events on Dashboard</strong></h3>
<p>Edit the Filebeat configuration file <code>/etc/filebeat/filebeat.yml</code> and change the value of <code>archives: enabled</code> from <code>false</code> to <code>true</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>archives:
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w"> </span>enabled:<span class="w"> </span><span class="nb">true</span>
</code></pre></div>
<p>Restart Filebeat to apply the configuration changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>filebeat
</code></pre></div>
<h3 id="configuring-wazuh-dashboard"><strong>Configuring Wazuh Dashboard</strong></h3>
<p>Click the upper-left menu icon and navigate to <strong>Dashboard</strong> <strong>management</strong> &gt; <strong>Index patterns</strong> &gt; <strong>Create index pattern</strong>. Use <code>wazuh-archives-*</code> as the index pattern name, and set <code>timestamp</code> in the <strong>Time field</strong> drop-down list.</p>
<p><a class="glightbox" href="image%2017.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2017.png" /></a></p>
<p><a class="glightbox" href="image%2018.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2018.png" /></a></p>
<p>To view the events on the dashboard, click the upper-left menu icon and navigate to <strong>Discover</strong>. Change the index pattern to <code>wazuh-archives-*</code>.</p>
<p><a class="glightbox" href="image%2019.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2019.png" /></a></p>
<h2 id="introduction-to-wazuh"><strong>Introduction to Wazuh</strong></h2>
<h3 id="use-case-detecting-signed-binary-proxy-execution"><strong>Use case: Detecting Signed Binary Proxy Execution</strong></h3>
<p>Signed binary proxy execution is a technique threat actors use to bypass application whitelisting by using trusted binaries to run malicious code. This technique is identified as <code>T1218.010</code> based on the MITRE ATT&amp;CK framework.</p>
<p>In this use case, we show how to abuse the Windows utility, <code>regsvr32.exe</code>, to bypass application controls. We then analyse events in the Wazuh archives to detect suspicious activity related to this technique.</p>
<h3 id="atomic-red-team-installation"><strong>Atomic Red Team Installation</strong></h3>
<p>Note: this has been tested in an isolated Unclassified environment. Perform the following steps to install the Atomic Red Team PowerShell module on a Windows endpoint using PowerShell as an administrator. By default, PowerShell restricts the execution of running scripts. Run the command below to change the default execution policy to <code>RemoteSigned</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nb">Set-ExecutionPolicy</span> <span class="n">RemoteSigned</span>
</code></pre></div>
<p>Install the ART execution framework:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="nb">IEX </span><span class="p">(</span><span class="nb">IWR </span><span class="s1">&#39;https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/install-atomicredteam.ps1&#39;</span> <span class="n">-UseBasicParsing</span><span class="p">);</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="nb">Install-AtomicRedTeam</span> <span class="n">-getAtomics</span>
</code></pre></div>
<p>Import the ART module to use <code>Invoke-AtomicTest</code> function</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nb">Import-Module</span> <span class="s2">&quot;C:\AtomicRedTeam\invoke-atomicredteam\Invoke-AtomicRedTeam.psd1&quot;</span> <span class="n">-Force</span>
</code></pre></div>
<p>Use <code>Invoke-AtomicTest</code> function to show details of the technique <code>T1218.010</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nb">Invoke-AtomicTest</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span> <span class="n">-ShowDetailsBrief</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c">#Example output</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="n">PathToAtomicsFolder</span> <span class="p">=</span> <span class="n">C</span><span class="p">:\</span><span class="n">AtomicRedTeam</span><span class="p">\</span><span class="n">atomics</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">1</span> <span class="n">Regsvr32</span> <span class="n">local</span> <span class="n">COM</span> <span class="n">scriptlet</span> <span class="n">execution</span>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">2</span> <span class="n">Regsvr32</span> <span class="n">remote</span> <span class="n">COM</span> <span class="n">scriptlet</span> <span class="n">execution</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">3</span> <span class="n">Regsvr32</span> <span class="n">local</span> <span class="n">DLL</span> <span class="n">execution</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">4</span> <span class="n">Regsvr32</span> <span class="n">Registering</span> <span class="n">Non</span> <span class="n">DLL</span>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">5</span> <span class="n">Regsvr32</span> <span class="n">Silent</span> <span class="n">DLL</span> <span class="n">Install</span> <span class="n">Call</span> <span class="n">DllRegisterServer</span>
</code></pre></div>
<h3 id="attack-emulation"><strong>Attack Emulation</strong></h3>
<p>Emulate the signed binary proxy execution technique on the Windows endpoint. Run the command below with Powershell as an administrator to perform the <code>T1218.010</code> test.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nb">Invoke-AtomicTest</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c">#Example output</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="n">PathToAtomicsFolder</span> <span class="p">=</span> <span class="n">C</span><span class="p">:\</span><span class="n">AtomicRedTeam</span><span class="p">\</span><span class="n">atomics</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="n">Executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">1</span> <span class="n">Regsvr32</span> <span class="n">local</span> <span class="n">COM</span> <span class="n">scriptlet</span> <span class="n">execution</span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="n">Done</span> <span class="n">executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">1</span> <span class="n">Regsvr32</span> <span class="n">local</span> <span class="n">COM</span> <span class="n">scriptlet</span> <span class="n">execution</span>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="n">Executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">2</span> <span class="n">Regsvr32</span> <span class="n">remote</span> <span class="n">COM</span> <span class="n">scriptlet</span> <span class="n">execution</span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="n">Done</span> <span class="n">executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">2</span> <span class="n">Regsvr32</span> <span class="n">remote</span> <span class="n">COM</span> <span class="n">scriptlet</span> <span class="n">execution</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="n">Executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">3</span> <span class="n">Regsvr32</span> <span class="n">local</span> <span class="n">DLL</span> <span class="n">execution</span>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="n">Done</span> <span class="n">executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">3</span> <span class="n">Regsvr32</span> <span class="n">local</span> <span class="n">DLL</span> <span class="n">execution</span>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="n">Executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">4</span> <span class="n">Regsvr32</span> <span class="n">Registering</span> <span class="n">Non</span> <span class="n">DLL</span>
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="n">Done</span> <span class="n">executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">4</span> <span class="n">Regsvr32</span> <span class="n">Registering</span> <span class="n">Non</span> <span class="n">DLL</span>
<a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="n">Executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">5</span> <span class="n">Regsvr32</span> <span class="n">Silent</span> <span class="n">DLL</span> <span class="n">Install</span> <span class="n">Call</span> <span class="n">DllRegisterServer</span>
<a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="n">Done</span> <span class="n">executing</span> <span class="n">test</span><span class="p">:</span> <span class="n">T1218</span><span class="p">.</span><span class="n">010</span><span class="p">-</span><span class="n">5</span> <span class="n">Regsvr32</span> <span class="n">Silent</span> <span class="n">DLL</span> <span class="n">Install</span> <span class="n">Call</span> <span class="n">DllRegisterServer</span>
</code></pre></div>
<p>Several calculator instances will pop up after a successful execution of the exploit.</p>
<p><a class="glightbox" href="image%2020.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2020.png" /></a></p>
<h3 id="wazuh-dashboard"><strong>Wazuh Dashboard</strong></h3>
<p>Use the Wazuh archives to query and display events related to the technique being hunted. It's important to note that while consulting the archives, some events might already be captured as alerts on the Wazuh dashboard. You can use information from the Wazuh archives, including alerts and events that have no detection to create custom rules based on your specific requirements.</p>
<p>Apply a time range filter to view events that occurred within the last five minutes of when the test was performed. Filter to view logs from the specific Windows endpoint using <code>agent.id</code>, <code>agent.ip</code> or <code>agent.name</code>.</p>
<p><a class="glightbox" href="image%2021.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2021.png" /></a></p>
<p>There are multiple hits that you can investigate to determine a correlation with the earlier attack emulation. For instance, you may notice a calculator spawning event similar to the one observed on the Windows endpoint during the test.</p>
<p><a class="glightbox" href="image%2022.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2022.png" /></a></p>
<p>Type <code>regsvr32</code> in the search bar to streamline and investigate events related to the <code>regsvr32</code> utility.</p>
<p><a class="glightbox" href="image%2023.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2023.png" /></a></p>
<p>Expand any of the events to view their associated fields.</p>
<p><a class="glightbox" href="image%2024.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2024.png" /></a></p>
<p>Click on the JSON tab to view the JSON format of the archived logs.</p>
<p><a class="glightbox" href="image%2025.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2025.png" /></a></p>
<p>Apply the <code>data.win.eventdata.ruleName:technique_id=T1218.010,technique_name=Regsvr32</code> filter to see the technique ID as shown below.</p>
<p><a class="glightbox" href="image%2026.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2026.png" /></a></p>
<p>It is recommended to enable archiving as it allows users to view logs from network devices. However, if you prefer not to enable archiving, similar search can be performed on wazuh-alerts-<em> (default) index instead of wazuh-archives-</em> index.</p>
<p>Navigate to Home, then Overview on the web UI</p>
<p>Select number displayed on the Critical severity</p>
<p><a class="glightbox" href="image%2027.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2027.png" /></a></p>
<p><a class="glightbox" href="image%2028.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2028.png" /></a></p>
<p>Clear all filters then add the filter data.wineventda.image is C:\Windows\SYSWOW64\regsvr32.exe</p>
<p><a class="glightbox" href="image%2029.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2029.png" /></a></p>
<h3 id="troubleshooting-index-patterns"><strong>Troubleshooting Index Patterns</strong></h3>
<p>If search results displays the error icon and the message “No cached mapping for this field. Refresh field list from the index patterns page,” go to Dashboard Management, Index patterns and select each index. Click refresh button. </p>
<p><a class="glightbox" href="image%2030.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2030.png" /></a></p>
<p><a class="glightbox" href="image%2031.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2031.png" /></a></p>
<h2 id="detecting-suspicious-binaries-testing-endpoint-security"><strong>Detecting Suspicious Binaries (Testing Endpoint Security)</strong></h2>
<p>Wazuh has anomaly and malware detection capabilities that detect suspicious binaries on an endpoint. Binaries are executable code written to perform automated tasks. Malicious actors use them mostly to carry out exploitation to avoid being detected.</p>
<p>In this use case, we demonstrate how the Wazuh rootcheck module can detect a trojan system binary on an Ubuntu endpoint. You perform the exploit by replacing the content of a legitimate binary with malicious code to trick the endpoint into running it as the legitimate binary.</p>
<p>The Wazuh rootcheck module also checks for hidden processes, ports, and files.</p>
<h3 id="configuration"><strong>Configuration</strong></h3>
<p>Take the following steps on the Ubuntu endpoint to enable the Wazuh rootcheck module and perform anomaly and malware detection.</p>
<p>By default, the Wazuh rootcheck module is enabled in the Wazuh agent configuration file. Check the <code>&lt;rootcheck&gt;</code> block in the <code>/var/ossec/etc/ossec.conf</code> configuration file of the monitored endpoint and make sure that it has the configuration below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>&lt;rootcheck&gt;
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">    </span>&lt;disabled&gt;no&lt;/disabled&gt;
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">    </span>&lt;check_files&gt;yes&lt;/check_files&gt;
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">    </span>&lt;!--<span class="w"> </span>Line<span class="w"> </span><span class="k">for</span><span class="w"> </span>trojans<span class="w"> </span>detection<span class="w"> </span>--&gt;
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">    </span>&lt;check_trojans&gt;yes&lt;/check_trojans&gt;
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">    </span>&lt;check_dev&gt;yes&lt;/check_dev&gt;
<a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">    </span>&lt;check_sys&gt;yes&lt;/check_sys&gt;
<a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">    </span>&lt;check_pids&gt;yes&lt;/check_pids&gt;
<a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">    </span>&lt;check_ports&gt;yes&lt;/check_ports&gt;
<a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">    </span>&lt;check_if&gt;yes&lt;/check_if&gt;
<a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a>
<a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">    </span>&lt;!--<span class="w"> </span>Frequency<span class="w"> </span>that<span class="w"> </span>rootcheck<span class="w"> </span>is<span class="w"> </span>executed<span class="w"> </span>-<span class="w"> </span>every<span class="w"> </span><span class="m">12</span><span class="w"> </span>hours<span class="w"> </span>--&gt;
<a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="w">    </span>&lt;frequency&gt;43200&lt;/frequency&gt;
<a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="w">    </span>&lt;rootkit_files&gt;/var/ossec/etc/shared/rootkit_files.txt&lt;/rootkit_files&gt;
<a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a><span class="w">    </span>&lt;rootkit_trojans&gt;/var/ossec/etc/shared/rootkit_trojans.txt&lt;/rootkit_trojans&gt;
<a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="w">    </span>&lt;skip_nfs&gt;yes&lt;/skip_nfs&gt;
<a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a>&lt;/rootcheck&gt;
</code></pre></div>
<h3 id="attack-emulation_1"><strong>Attack Emulation</strong></h3>
<p>Create a copy of the original system binary:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>-p<span class="w"> </span>/usr/bin/w<span class="w"> </span>/usr/bin/w.copy
</code></pre></div>
<p>Replace the original system binary <code>/usr/bin/w</code> with the following shell script:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/bin/w<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="s">!/bin/bash</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="s">echo &quot;`date` this is evil&quot; &gt; /tmp/trojan_created_file</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="s">echo &#39;test for /usr/bin/w trojaned file&#39; &gt;&gt; /tmp/trojan_created_file</span>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="s">Now running original binary</span>
<a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="s">/usr/bin/w.copy</span>
<a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="s">EOF</span>
</code></pre></div>
<p>The rootcheck scan runs every 12 hours by default. Force a scan by restarting the Wazuh agent to see the relevant alert:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-agent
</code></pre></div>
<h3 id="visualising-alerts"><strong>Visualising Alerts</strong></h3>
<p>You can visualise the alert data in the Wazuh dashboard. To do this, go to the <strong>Threat Hunting</strong> module and add the filters in the search bar to query the alerts.
<code>location:rootcheck AND rule.id:510</code></p>
<p><a class="glightbox" href="image%2032.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2032.png" /></a></p>
<h2 id="file-integrity-monitoring-testing-endpoint-security"><strong>File Integrity Monitoring (Testing Endpoint Security)</strong></h2>
<p>File Integrity Monitoring (FIM) helps in auditing sensitive files and meeting regulatory compliance requirements. Wazuh has an inbuilt FIM module that monitors file system changes to detect the creation, modification, and deletion of files.</p>
<h3 id="configuring-ubuntu-endpoint"><strong>Configuring Ubuntu Endpoint</strong></h3>
<p>Edit the Wazuh agent <code>/var/ossec/etc/ossec.conf</code> configuration file. Add the directories for monitoring within the <code>&lt;syscheck&gt;</code> block. For this use case, you configure Wazuh to monitor the <code>/root</code> directory. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>&lt;directories<span class="w"> </span><span class="nv">check_all</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="nv">report_changes</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="nv">realtime</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>&gt;/root&lt;/directories&gt;
</code></pre></div>
<p>Restart the Wazuh agent to apply the configuration changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-agent
</code></pre></div>
<h3 id="testing-configuration"><strong>Testing Configuration</strong></h3>
<ol>
<li>Create a text file in the monitored directory then wait for 5 seconds.</li>
<li>Add content to the text file and save it. Wait for 5 seconds.</li>
<li>Delete the text file from the monitored directory.</li>
</ol>
<h3 id="visualising-alerts_1"><strong>Visualising Alerts</strong></h3>
<p>You can visualise the alert data in the Wazuh dashboard. To do this, go to the <strong>File Integrity Monitoring</strong> module and add the filters in the search bar to query the alerts:<code>rule.id: is one of 550,553,554</code></p>
<p><a class="glightbox" href="image%2033.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2033.png" /></a></p>
<h2 id="vulnerability-detection-testing-threat-intelligence"><strong>Vulnerability Detection (Testing Threat Intelligence)</strong></h2>
<p>Wazuh uses the Vulnerability Detection module to identify vulnerabilities in applications and operating systems running on endpoints.</p>
<p>This use case shows how Wazuh detects unpatched Common Vulnerabilities and Exposures (CVEs) in the monitored endpoint.</p>
<h3 id="configuration_1"><strong>Configuration</strong></h3>
<p>The Vulnerability Detection module is enabled by default. You can perform the following steps on the Wazuh server to ensure that the Wazuh Vulnerability Detection module is enabled and properly configured.</p>
<p>Open the <code>/var/ossec/etc/ossec.conf</code> file on the Wazuh server. Check the following settings.
Vulnerability Detection is enabled:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>&lt;vulnerability-detection&gt;
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">   </span>&lt;enabled&gt;yes&lt;/enabled&gt;
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">   </span>&lt;index-status&gt;yes&lt;/index-status&gt;
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">   </span>&lt;feed-update-interval&gt;60m&lt;/feed-update-interval&gt;
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>&lt;/vulnerability-detection&gt;
</code></pre></div>
<p>The indexer connection is properly configured. By default, the indexer settings have one host configured. It's set to <code>0.0.0.0</code> as highlighted below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>&lt;indexer&gt;
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">  </span>&lt;enabled&gt;yes&lt;/enabled&gt;
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">  </span>&lt;hosts&gt;
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">    </span>&lt;host&gt;https://0.0.0.0:9200&lt;/host&gt;
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w">  </span>&lt;/hosts&gt;
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">  </span>&lt;ssl&gt;
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">    </span>&lt;certificate_authorities&gt;
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">      </span>&lt;ca&gt;/etc/filebeat/certs/root-ca.pem&lt;/ca&gt;
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">    </span>&lt;/certificate_authorities&gt;
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">    </span>&lt;certificate&gt;/etc/filebeat/certs/filebeat.pem&lt;/certificate&gt;
<a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">    </span>&lt;key&gt;/etc/filebeat/certs/filebeat-key.pem&lt;/key&gt;
<a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">  </span>&lt;/ssl&gt;
<a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a>&lt;/indexer&gt;
</code></pre></div>
<p>Replace <code>0.0.0.0</code> with your Wazuh indexer node IP address or hostname. You can find this value in the Filebeat config file <code>/etc/filebeat/filebeat.yml</code>. Ensure the Filebeat certificate and key name match the certificate files in <code>/etc/filebeat/certs</code>. If you made changes to the configuration, restart the Wazuh manager.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-manager
</code></pre></div>
<h3 id="visualising-alerts_2"><strong>Visualising Alerts</strong></h3>
<p>You can visualise the detected vulnerabilities in the Wazuh dashboard. To see a list of active vulnerabilities, go to <strong>Vulnerability Detection</strong> and select <strong>Inventory</strong>.</p>
<p><a class="glightbox" href="image%2034.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2034.png" /></a></p>
<p><a class="glightbox" href="image%2035.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2035.png" /></a></p>
<h2 id="incident-response"><strong>Incident Response</strong></h2>
<p>The goal of incident response is to effectively handle a security incident and restore normal business operations as quickly as possible. As organizations’ digital assets continuously grow, managing incidents manually becomes increasingly challenging, hence the need for automation.</p>
<h3 id="wazuh-active-response-module"><strong>Wazuh Active Response module</strong></h3>
<p>The Wazuh Active Response module allows users to run automated actions when incidents are detected on endpoints. This improves an organization's incident response processes, enabling security teams to take immediate and automated actions to counter detected threats.</p>
<h3 id="default-active-response-actions"><strong>Default Active Response Actions</strong></h3>
<p>Out-of-the-box scripts are available on every operating system that runs the Wazuh agents. Some of the default active response scripts include</p>
<table>
<thead>
<tr>
<th><strong>Name of script</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>disable-account</td>
<td>Disables a user account</td>
</tr>
<tr>
<td>firewall-drop</td>
<td>Adds an IP address to the iptables deny list.</td>
</tr>
<tr>
<td>firewalld-drop</td>
<td>Adds an IP address to the firewalld drop list.</td>
</tr>
<tr>
<td>restart.sh</td>
<td>Restarts the Wazuh agent or server.</td>
</tr>
<tr>
<td>netsh.exe</td>
<td>Blocks an IP address using netsh.</td>
</tr>
</tbody>
</table>
<h3 id="custom-active-response-actions"><strong>Custom Active Response Actions</strong></h3>
<p>One of the benefits of the Wazuh Active Response module is its adaptability. Wazuh allows security teams to create custom active response actions in any programming language, tailoring them to their specific needs.</p>
<h3 id="disabling-user-account-after-a-brute-force-attack-testing-default-active-response"><strong>Disabling User Account After a Brute-Force Attack (Testing Default Active Response)</strong></h3>
<p>Account lockout is a security measure used to defend against brute force attacks by limiting the number of login attempts a user can make within a specified time. We use the Wazuh Active Response module to disable the user account whose password is being guessed by an attacker.</p>
<p>In the image below, the Wazuh Active Response module disables the account on a Linux endpoint and re-enables it again after 5 minutes.</p>
<p>After SSH Brute Force attack was launched from Kali machine, the login was disabled for 60 seconds because of 3 bad attempts</p>
<p><a class="glightbox" href="image%2036.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2036.png" /></a></p>
<h2 id="blocking-a-known-malicious-actor-testing-custom-active-response"><strong>Blocking a Known Malicious Actor (Testing Custom Active Response)</strong></h2>
<p>In this use case, we demonstrate how to block malicious IP addresses from accessing web resources on a web server. </p>
<h3 id="configuring-ubuntu-endpoint_1"><strong>Configuring Ubuntu endpoint</strong></h3>
<p>Update local packages and install the Apache web server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>apache2
</code></pre></div>
<p>If the firewall is enabled, modify the firewall to allow external access to web ports. Skip this step if the firewall is disabled:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>status
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>app<span class="w"> </span>list
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="s1">&#39;Apache&#39;</span>
</code></pre></div>
<p>Check the status of the Apache service to verify that the web server is running:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>apache2
</code></pre></div>
<p>Use the <code>curl</code> command or open <code>http://&lt;UBUNTU_IP&gt;</code> in a browser to view the Apache landing page and verify the installation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>curl<span class="w"> </span>http://&lt;UBUNTU_IP&gt;
</code></pre></div>
<p>Add the following to <code>/var/ossec/etc/ossec.conf</code> file to configure the Wazuh agent and monitor the Apache access logs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>&lt;localfile&gt;
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">  </span>&lt;log_format&gt;syslog&lt;/log_format&gt;
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">  </span>&lt;location&gt;/var/log/apache2/access.log&lt;/location&gt;
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>&lt;/localfile&gt;
</code></pre></div>
<p>Restart the Wazuh agent to apply the changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-agent
</code></pre></div>
<h3 id="configuring-the-wazuh-server"><strong>Configuring the Wazuh server</strong></h3>
<p>Download the utilities and configure the CDB list. Download the Alienvault IP reputation database:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>sudo<span class="w"> </span>wget<span class="w"> </span>https://raw.githubusercontent.com/firehol/blocklist-ipsets/master/alienvault_reputation.ipset<span class="w"> </span>-O<span class="w"> </span>/var/ossec/etc/lists/alienvault_reputation.ipset
</code></pre></div>
<p>Append the IP address of the attacker endpoint to the IP reputation database. Replace <code>&lt;ATTACKER_IP&gt;</code> with the Kali IP address in the command below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>sudo<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;ATTACKER_IP&gt;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/var/ossec/etc/lists/alienvault_reputation.ipset
</code></pre></div>
<p>Download a script to convert from the <code>.ipset</code> format to the <code>.cdb</code> list format:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>sudo<span class="w"> </span>wget<span class="w"> </span>https://wazuh.com/resources/iplist-to-cdblist.py<span class="w"> </span>-O<span class="w"> </span>/tmp/iplist-to-cdblist.py
</code></pre></div>
<p>Convert the <code>alienvault_reputation.ipset</code> file to a <code>.cdb</code> format using the previously downloaded script:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>sudo<span class="w"> </span>/var/ossec/framework/python/bin/python3<span class="w"> </span>/tmp/iplist-to-cdblist.py<span class="w"> </span>/var/ossec/etc/lists/alienvault_reputation.ipset<span class="w"> </span>/var/ossec/etc/lists/blacklist-alienvault
</code></pre></div>
<p>Assign the right permissions and ownership to the generated file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>wazuh:wazuh<span class="w"> </span>/var/ossec/etc/lists/blacklist-alienvault
</code></pre></div>
<h3 id="configure-the-active-response-module-to-block-the-malicious-ip-address"><strong>Configure the active response module to block the malicious IP address</strong></h3>
<p>Add a custom rule to trigger a Wazuh active response script. Do this in the Wazuh server <code>/var/ossec/etc/rules/local_rules.xml</code> custom ruleset file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>&lt;group<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;attack,&quot;</span>&gt;
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="w">  </span>&lt;rule<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;100100&quot;</span><span class="w"> </span><span class="nv">level</span><span class="o">=</span><span class="s2">&quot;10&quot;</span>&gt;
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w">    </span>&lt;if_group&gt;web<span class="p">|</span>attack<span class="p">|</span>attacks&lt;/if_group&gt;
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="w">    </span>&lt;list<span class="w"> </span><span class="nv">field</span><span class="o">=</span><span class="s2">&quot;srcip&quot;</span><span class="w"> </span><span class="nv">lookup</span><span class="o">=</span><span class="s2">&quot;address_match_key&quot;</span>&gt;etc/lists/blacklist-alienvault&lt;/list&gt;
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">    </span>&lt;description&gt;IP<span class="w"> </span>address<span class="w"> </span>found<span class="w"> </span><span class="k">in</span><span class="w"> </span>AlienVault<span class="w"> </span>reputation<span class="w"> </span>database.&lt;/description&gt;
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">  </span>&lt;/rule&gt;
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>&lt;/group&gt;
</code></pre></div>
<p>Edit the Wazuh server <code>/var/ossec/etc/ossec.conf</code> configuration file and add the <code>etc/lists/blacklist-alienvault</code> list to the <code>&lt;ruleset&gt;</code> section:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>&lt;ossec_config&gt;
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="w">  </span>&lt;ruleset&gt;
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="w">    </span>&lt;!--<span class="w"> </span>Default<span class="w"> </span>ruleset<span class="w"> </span>--&gt;
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="w">    </span>&lt;decoder_dir&gt;ruleset/decoders&lt;/decoder_dir&gt;
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="w">    </span>&lt;rule_dir&gt;ruleset/rules&lt;/rule_dir&gt;
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="w">    </span>&lt;rule_exclude&gt;0215-policy_rules.xml&lt;/rule_exclude&gt;
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="w">    </span>&lt;list&gt;etc/lists/audit-keys&lt;/list&gt;
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="w">    </span>&lt;list&gt;etc/lists/amazon/aws-eventnames&lt;/list&gt;
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="w">    </span>&lt;list&gt;etc/lists/security-eventchannel&lt;/list&gt;
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a><span class="w">    </span>&lt;list&gt;etc/lists/blacklist-alienvault&lt;/list&gt;
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a><span class="w">    </span>&lt;!--<span class="w"> </span>User-defined<span class="w"> </span>ruleset<span class="w"> </span>--&gt;
<a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a><span class="w">    </span>&lt;decoder_dir&gt;etc/decoders&lt;/decoder_dir&gt;
<a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a><span class="w">    </span>&lt;rule_dir&gt;etc/rules&lt;/rule_dir&gt;
<a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a><span class="w">  </span>&lt;/ruleset&gt;
<a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a>
<a id="__codelineno-111-17" name="__codelineno-111-17" href="#__codelineno-111-17"></a>&lt;/ossec_config&gt;
</code></pre></div>
<p>Add the active response block to the Wazuh server <code>/var/ossec/etc/ossec.conf</code> file:</p>
<p>The <code>firewall-drop</code> command integrates with the Ubuntu local iptables firewall and drops incoming network connection from the attacker endpoint for 60 seconds:
Remember to uncomment the code block (remove <code>&lt;!--</code> and <code>--&gt;</code> )</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>&lt;ossec_config&gt;
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="w">  </span>&lt;active-response&gt;
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">    </span>&lt;command&gt;firewall-drop&lt;/command&gt;
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="w">    </span>&lt;location&gt;local&lt;/location&gt;
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">    </span>&lt;rules_id&gt;100100&lt;/rules_id&gt;
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="w">    </span>&lt;timeout&gt;60&lt;/timeout&gt;
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="w">  </span>&lt;/active-response&gt;
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>&lt;/ossec_config&gt;
</code></pre></div>
<p>Restart the Wazuh manager to apply the changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-manager
</code></pre></div>
<h3 id="attack-emulation_2"><strong>Attack Emulation</strong></h3>
<p>Access any of the web servers from the Kali endpoint using the corresponding IP address. Replace <code>&lt;WEBSERVER_IP&gt;</code> with the appropriate value and execute the following command from the attacker endpoint:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>curl<span class="w"> </span>http://&lt;WEBSERVER_IP&gt;
</code></pre></div>
<p>The attacker endpoint connects to the victim's web servers the first time. After the first connection, the Wazuh active response module temporarily blocks any successive connection to the web servers for 60 seconds.</p>
<p><a class="glightbox" href="image%2037.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2037.png" /></a></p>
<h3 id="visualising-alerts_3"><strong>Visualising Alerts</strong></h3>
<p>You can visualize the alert data in the Wazuh dashboard. To do this, go to the <strong>Threat Hunting</strong> module and add the filters in the search bar to query the alerts: <code>rule.id is one of 651, 100100</code></p>
<p><a class="glightbox" href="image%2038.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2038.png" /></a></p>
<h2 id="network-ids-integration"><strong>Network IDS integration</strong></h2>
<h3 id="snort3"><strong>Snort3</strong></h3>
<p>Install Wazuh agent on a Linux host where Snort3 is installed. Edit Snort’s configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/usr/local/etc/snort/snort.lua
</code></pre></div>
<p>Uncomment alert_full and add file=true</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>---------------------------------------------------------------------------
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>--<span class="w"> </span><span class="m">7</span>.<span class="w"> </span>configure<span class="w"> </span>outputs
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a>---------------------------------------------------------------------------
<a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a>
<a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a>--<span class="w"> </span>event<span class="w"> </span>logging
<a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a>--<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>with<span class="w"> </span>defaults<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span><span class="nb">command</span><span class="w"> </span>line<span class="w"> </span>with<span class="w"> </span>-A<span class="w"> </span>&lt;alert_type&gt;
<a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a>--<span class="w"> </span>uncomment<span class="w"> </span>below<span class="w"> </span>to<span class="w"> </span><span class="nb">set</span><span class="w"> </span>non-default<span class="w"> </span>configs
<a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a>--alert_csv<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a>--alert_fast<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="nv">file</span><span class="o">=</span>true<span class="o">}</span>
<a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="nv">alert_full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="nv">file</span><span class="o">=</span>true<span class="o">}</span>
<a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a>--alert_sfsocket<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a>--alert_syslog<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a>--unified2<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span>
</code></pre></div>
<p>Edit the <code>/var/ossec/etc/ossec.conf</code> file of Wazuh agent and add the new <code>localfile</code> entry:
Make sure indentation is correct.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>&lt;localfile&gt;
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w">  </span>&lt;log_format&gt;snort-full&lt;/log_format&gt;
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="w">  </span>&lt;location&gt;/var/log/snort/alert_full.txt&lt;/location&gt;
<a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a>&lt;/localfile&gt;
</code></pre></div>
<p>Restart the Wazuh agent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-agent
</code></pre></div>
<p>Run Snort3 with the following parameters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>sudo<span class="w"> </span>snort<span class="w"> </span>-c<span class="w"> </span>/usr/local/etc/snort/snort.lua<span class="w"> </span>-i<span class="w"> </span>ens32<span class="w"> </span>-A<span class="w"> </span>alert_full<span class="w"> </span>-l<span class="w"> </span>/var/log/snort
</code></pre></div>
<p>Note: Snort3 is currently configured to read local.rules for demonstration purposes. </p>
<p>Execute ping to 10.0.0.22 (Snort3 VM) from another host. Verify alert_full.txt is generated</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>root@Snort:/var/log/snort#<span class="w"> </span>ls
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>alert_fast.txt<span class="w">  </span>alert_full.txt
</code></pre></div>
<p>On Wazuh dashboard, verify IDS Event alerts are generated and it points to alert_full.txt</p>
<p><a class="glightbox" href="image%2039.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2039.png" /></a></p>
<p><a class="glightbox" href="image%2040.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2040.png" /></a></p>
<h3 id="suricata"><strong>Suricata</strong></h3>
<p>Install Wazuh agent on a Linux host where Suricata is installed. Changes the permissions of all files in the Suricata’s <code>/rules/</code> directories:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/var/lib/suricata/rules/*.rules
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/usr/share/suricata/rules/*.rules
</code></pre></div>
<p>Modify Suricata settings in the <code>/etc/suricata/suricata.yaml</code> file and set the following variables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>vars:
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="w">  </span><span class="c1"># more specific is better for alert accuracy and performance</span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="w">  </span>address-groups:
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">    </span>HOME_NET:<span class="w"> </span><span class="s2">&quot;[10.0.0.0/24]&quot;</span>
<a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a>...
<a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a>community-id:<span class="w"> </span><span class="nb">true</span>
<a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a>...
<a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a>af-packet:
<a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">    </span>-<span class="w"> </span>interface:<span class="w"> </span>ens32
<a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">      </span>cluster-id:<span class="w"> </span><span class="m">99</span>
<a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">      </span>cluster-type:<span class="w"> </span>cluster_flow
<a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">      </span>defrag:<span class="w"> </span>yes
<a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="w">      </span>use-mmap:<span class="w"> </span>yes
<a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a>...
<a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="c1"># Cross platform libpcap capture support</span>
<a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a>pcap:
<a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="w">  </span>-<span class="w"> </span>interface:<span class="w"> </span>ens32
</code></pre></div>
<p><code>interface</code> represents the network interface you want to monitor. Replace the value with the interface name of the Ubuntu endpoint. For example, <code>ens32</code> </p>
<p>Restart the Suricata service:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>suricata
</code></pre></div>
<p>Add the following configuration to the <code>/var/ossec/etc/ossec.conf</code> file of the Wazuh agent. This allows the Wazuh agent to read the Suricata logs file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a>&lt;ossec_config&gt;
<a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="w">  </span>&lt;localfile&gt;
<a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="w">    </span>&lt;log_format&gt;json&lt;/log_format&gt;
<a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w">    </span>&lt;location&gt;/var/log/suricata/eve.json&lt;/location&gt;
<a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="w">  </span>&lt;/localfile&gt;
<a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a>&lt;/ossec_config&gt;
</code></pre></div>
<p>Restart the Wazuh agent to apply the changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>wazuh-agent
</code></pre></div>
<h3 id="attack-emulation_3"><strong>Attack Emulation</strong></h3>
<p>Wazuh automatically parses data from <code>/var/log/suricata/eve.json</code> and generates related alerts on the Wazuh dashboard. From the Ubuntu host, run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>curl<span class="w"> </span>http://testmynids.org/uid/index.html
</code></pre></div>
<p>Expected response should be similar to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="m">09</span>/12/2024-13:51:32.520238<span class="w">  </span><span class="o">[</span>**<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1</span>:2100498:7<span class="o">]</span><span class="w"> </span>GPL<span class="w"> </span>ATTACK_RESPONSE<span class="w"> </span>id<span class="w"> </span>check<span class="w"> </span>returned<span class="w"> </span>root<span class="w"> </span><span class="o">[</span>**<span class="o">]</span><span class="w"> </span><span class="o">[</span>Classification:<span class="w"> </span>Potentially<span class="w"> </span>Bad<span class="w"> </span>Traffic<span class="o">]</span><span class="w"> </span><span class="o">[</span>Priority:<span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">{</span>TCP<span class="o">}</span><span class="w"> </span><span class="m">65</span>.9.141.53:80<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">10</span>.0.0.25:34606Alerts:
</code></pre></div>
<p>Verify the results in Wazuh dashboard. Naviage to Threat Hunting &gt; Suricata</p>
<p><a class="glightbox" href="image%2041.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2041.png" /></a></p>
<h2 id="references"><strong>References</strong></h2>
<ul>
<li>https://www.youtube.com/watch?v=Lb_ukgtYK_U&amp;list=PLG6KGSNK4PuBWmX9NykU0wnWamjxdKhDJ&amp;index=5</li>
<li>https://documentation.wazuh.com/current/deployment-options/offline-installation.html</li>
<li>https://wazuh.com/blog/monitoring-network-devices/?highlight=network device</li>
<li>https://dorian5.medium.com/rsyslog-setup-on-ubuntu-for-fortigate-log-data-9d6c651acbd0</li>
<li>https://wazuh.com/blog/monitoring-network-devices/?highlight=network device</li>
<li>https://wazuh.com/blog/creating-decoders-and-rules-from-scratch/?highlight=fortigate</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../splunk/splunk.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Splunk">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Splunk
              </div>
            </div>
          </a>
        
        
          
          <a href="../understanding-IDS-IPS/understanding-IDS-IPS.html" class="md-footer__link md-footer__link--next" aria-label="Next: Understanding IDS/IPS">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Understanding IDS/IPS
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024–2025 <a href="https://github.com/cyberdefencekit" target="_blank" rel="noopener">Cyber Defence Kit by Joseph Jee</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/cyberdefencekit" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "header.autohide", "announce.dismiss", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "navigation.expand", "search.highlight", "search.share", "search.suggest", "toc.integrate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>